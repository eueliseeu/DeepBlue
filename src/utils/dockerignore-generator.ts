import { Technology } from "../types";

const COMMON_PATTERNS = [
  "# Git",
  ".git",
  ".gitignore",
  ".gitattributes",
  "",
  "# CI/CD",
  ".github",
  ".gitlab-ci.yml",
  ".travis.yml",
  ".circleci",
  "",
  "# IDE",
  ".vscode",
  ".idea",
  "*.swp",
  "*.swo",
  "*~",
  ".DS_Store",
  "",
  "# Documentation",
  "README.md",
  "CHANGELOG.md",
  "LICENSE",
  "*.md",
  "docs/",
  "",
  "# Docker",
  "Dockerfile",
  "docker-compose.yml",
  ".dockerignore",
  "",
  "# Logs",
  "*.log",
  "logs/",
];

const NODE_PATTERNS = [
  "# Node.js",
  "node_modules/",
  "npm-debug.log*",
  "yarn-debug.log*",
  "yarn-error.log*",
  ".npm",
  ".yarn",
  "",
  "# Testing",
  "coverage/",
  ".nyc_output/",
  "*.test.js",
  "*.spec.js",
  "__tests__/",
  "",
  "# Build",
  "dist/",
  "build/",
  ".next/",
  "out/",
  "",
  "# Environment",
  ".env",
  ".env.local",
  ".env.*.local",
];

const PYTHON_PATTERNS = [
  "# Python",
  "__pycache__/",
  "*.py[cod]",
  "*$py.class",
  "*.so",
  ".Python",
  "",
  "# Virtual environments",
  "venv/",
  "env/",
  "ENV/",
  ".venv/",
  "",
  "# Testing",
  ".pytest_cache/",
  ".coverage",
  "htmlcov/",
  "*.cover",
  "",
  "# Distribution",
  "dist/",
  "build/",
  "*.egg-info/",
  ".eggs/",
  "",
  "# Jupyter",
  ".ipynb_checkpoints/",
  "*.ipynb",
];

const GO_PATTERNS = [
  "# Go",
  "*.exe",
  "*.exe~",
  "*.dll",
  "*.so",
  "*.dylib",
  "",
  "# Testing",
  "*.test",
  "*.out",
  "coverage.txt",
  "",
  "# Build",
  "bin/",
  "pkg/",
  "vendor/",
];

const JAVA_PATTERNS = [
  "# Java",
  "*.class",
  "*.jar",
  "*.war",
  "*.ear",
  "",
  "# Build tools",
  "target/",
  "build/",
  ".gradle/",
  "gradle/",
  ".mvn/",
  "",
  "# IDE",
  "*.iml",
  ".classpath",
  ".project",
  ".settings/",
];

const PHP_PATTERNS = [
  "# PHP",
  "vendor/",
  "composer.lock",
  "composer.phar",
  "",
  "# Laravel specific",
  "storage/",
  "bootstrap/cache/",
  ".env",
  "",
  "# Testing",
  ".phpunit.result.cache",
  "coverage/",
];

const RUBY_PATTERNS = [
  "# Ruby",
  "*.gem",
  "*.rbc",
  ".bundle/",
  "vendor/bundle/",
  "",
  "# Rails specific",
  "log/",
  "tmp/",
  ".byebug_history",
  "",
  "# Testing",
  ".rspec",
  "spec/reports/",
  "coverage/",
];

const RUST_PATTERNS = [
  "# Rust",
  "target/",
  "Cargo.lock",
  "**/*.rs.bk",
  "",
  "# Testing",
  "*.profraw",
  "*.gcda",
];

export const generateDockerIgnore = (technology: Technology): string => {
  const patterns: Record<Technology, string[]> = {
    node: [...COMMON_PATTERNS, ...NODE_PATTERNS],
    python: [...COMMON_PATTERNS, ...PYTHON_PATTERNS],
    go: [...COMMON_PATTERNS, ...GO_PATTERNS],
    java: [...COMMON_PATTERNS, ...JAVA_PATTERNS],
    php: [...COMMON_PATTERNS, ...PHP_PATTERNS],
    ruby: [...COMMON_PATTERNS, ...RUBY_PATTERNS],
    rust: [...COMMON_PATTERNS, ...RUST_PATTERNS],
  };

  const header = [
    "# Generated by DeepBlue CLI",
    `# Optimized .dockerignore for ${technology.toUpperCase()}`,
    "# This file prevents unnecessary files from being sent to Docker build context",
    "",
  ];

  return [...header, ...patterns[technology]].join("\n");
};
